const express = require('express');
const router = express.Router();

const Client = require('../models/clients');

router.post('/api/client/auth', async (req, res) => {
  const email = req.body.email || false;

  if (!email) {
    return res.status(400).send({message: 'Bad Request'});
  }

  const client = await Client.findOne({email});

  if (!client) {
    const newClient = new Client({name: req.body.name,
      email: req.body.email,
      notificationToken: req.body.notificationToken,
      profile: req.body.profile
    });

    const page = await newClient.save();
    return res.status(201).send({message: 'Client registered'});
  }

  client.notificationToken = req.body.notificationToken;
  client.name = req.body.name;
  client.email = req.body.email;
  client.profile = req.body.profile;
  client.last_login = Date.now();

  await client.save();

  return res.status(200).send({message: 'Client updated'});

});

module.exports = router;
